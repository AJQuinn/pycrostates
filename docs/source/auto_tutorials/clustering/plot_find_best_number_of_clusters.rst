
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_tutorials\clustering\plot_find_best_number_of_clusters.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_auto_tutorials_clustering_plot_find_best_number_of_clusters.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_tutorials_clustering_plot_find_best_number_of_clusters.py:


Clustering performance evaluation
=================================

This example shows how to evaluate the quality of the clustering and gives an indication of how many clusters to choose.
This step can be done at different stages of the analysis, at the subject or group level for example.
Pycrostates implements different scores to evaluate the quality of clustering, we will see how to use them.

.. GENERATED FROM PYTHON SOURCE LINES 9-28

.. code-block:: default


    from mne.io import read_raw_edf
    from mne.datasets import eegbci
    from mne.channels import make_standard_montage
    from pycrostates.clustering import ModKMeans

    subject = 1
    runs = [1]

    raw_fnames = eegbci.load_data(subject, runs, update_path=True)[0]
    raw = read_raw_edf(raw_fnames, preload=True)
    eegbci.standardize(raw)  # set channel names

    raw.rename_channels(lambda x: x.strip('.'))
    montage = make_standard_montage('standard_1005')
    raw.set_montage(montage)

    raw.pick('eeg')
    raw.set_eeg_reference('average')




.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    Extracting EDF parameters from C:\Users\Victor\mne_data\MNE-eegbci-data\files\eegmmidb\1.0.0\S001\S001R01.edf...
    EDF file detected
    Setting channel info structure...
    Creating raw.info structure...
    Reading 0 ... 9759  =      0.000 ...    60.994 secs...
    EEG channel type selected for re-referencing
    Applying average reference.
    Applying a custom EEG reference.

    <RawEDF | S001R01.edf, 64 x 9760 (61.0 s), ~4.9 MB, data loaded>



.. GENERATED FROM PYTHON SOURCE LINES 29-30

We must first fit our clustering algorithm (in our case the modified Kmeans) with some data.

.. GENERATED FROM PYTHON SOURCE LINES 30-34

.. code-block:: default

    n_clusters = 4
    ModK = ModKMeans(n_clusters=n_clusters, random_state=42)
    ModK.fit(raw, n_jobs=5)
    ModK.plot()



.. image:: /auto_tutorials/clustering/images/sphx_glr_plot_find_best_number_of_clusters_001.png
    :alt: 1, 2, 3, 4
    :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    Fitting modified Kmeans with Raw data
    Running Kmeans for 4 clusters centers with 100 random initialisations.
      0%|                                                                                                                                                   |  : 0/100 [00:00<?,       ?it/s]      5%|#######1                                                                                                                                       |  : 5/100 [00:00<00:08,   11.79it/s]     10%|##############2                                                                                                                               |  : 10/100 [00:00<00:07,   11.65it/s]     15%|#####################3                                                                                                                        |  : 15/100 [00:01<00:07,   11.44it/s]     20%|############################4                                                                                                                 |  : 20/100 [00:02<00:07,   11.16it/s]     25%|###################################5                                                                                                          |  : 25/100 [00:02<00:06,   11.19it/s]     30%|##########################################6                                                                                                   |  : 30/100 [00:03<00:06,   11.07it/s]     35%|#################################################6                                                                                            |  : 35/100 [00:03<00:05,   11.03it/s]     40%|########################################################8                                                                                     |  : 40/100 [00:04<00:05,   10.84it/s]     45%|###############################################################9                                                                              |  : 45/100 [00:04<00:05,   10.76it/s]     50%|#######################################################################                                                                       |  : 50/100 [00:05<00:04,   10.72it/s]     55%|##############################################################################1                                                               |  : 55/100 [00:05<00:04,   10.50it/s]     60%|#####################################################################################2                                                        |  : 60/100 [00:06<00:03,   10.53it/s]     65%|############################################################################################3                                                 |  : 65/100 [00:07<00:03,   10.36it/s]     70%|###################################################################################################3                                          |  : 70/100 [00:07<00:02,   10.12it/s]     75%|##########################################################################################################5                                   |  : 75/100 [00:08<00:02,   10.21it/s]     80%|#################################################################################################################6                            |  : 80/100 [00:08<00:01,   10.21it/s]     85%|########################################################################################################################7                     |  : 85/100 [00:09<00:01,   10.34it/s]     90%|###############################################################################################################################8              |  : 90/100 [00:09<00:00,   10.30it/s]     95%|######################################################################################################################################9       |  : 95/100 [00:10<00:00,   10.25it/s]    100%|#############################################################################################################################################|  : 100/100 [00:10<00:00,   10.13it/s]    100%|#############################################################################################################################################|  : 100/100 [00:10<00:00,    9.38it/s]
    Selecting run with highest GEV = 0.6816047968052894%.

    (<Figure size 640x480 with 4 Axes>, array([<matplotlib.axes._subplots.AxesSubplot object at 0x0000019E93929288>,
           <matplotlib.axes._subplots.AxesSubplot object at 0x0000019E90061B88>,
           <matplotlib.axes._subplots.AxesSubplot object at 0x0000019E90089C08>,
           <matplotlib.axes._subplots.AxesSubplot object at 0x0000019E92D69D08>],
          dtype=object))



.. GENERATED FROM PYTHON SOURCE LINES 35-36

We can then compute several clustering performance score on the fitted instance.

.. GENERATED FROM PYTHON SOURCE LINES 36-46

.. code-block:: default

    from pycrostates.metrics import silhouette, davies_bouldin, calinski_harabasz, dunn

    silhouette_score = silhouette(ModK)
    print('silhouette score: ', silhouette_score)
    davies_bouldin_score = davies_bouldin(ModK)
    print('davies-bouldin score: ', davies_bouldin_score)
    calinski_harabasz_score = calinski_harabasz(ModK)
    print('calinski-harabasz score: ', calinski_harabasz_score)
    dunn_score = dunn(ModK)
    print('dunn score: ', dunn_score)




.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    silhouette score:  0.29395443485220446
    davies-bouldin score:  264702322178.25702
    calinski-harabasz score:  25.7026852571138
    dunn score:  1.679228880253539e-20




.. GENERATED FROM PYTHON SOURCE LINES 47-48

We can compute this score for differents values of n_clusters.

.. GENERATED FROM PYTHON SOURCE LINES 48-69

.. code-block:: default

    K = range(4,8)
    silhouette_scores = list()
    davies_bouldin_scores = list()
    calinski_harabasz_scores = list()
    dunn_scores = list()
    for k in K:
        ModK = ModKMeans(n_clusters=k, random_state=42)
        ModK.fit(raw, n_jobs=5)
    
        silhouette_score = silhouette(ModK)
        silhouette_scores.append(silhouette_score)
    
        davies_bouldin_score = davies_bouldin(ModK)
        davies_bouldin_scores.append(davies_bouldin_score)
    
        calinski_harabasz_score = calinski_harabasz(ModK)
        calinski_harabasz_scores.append(calinski_harabasz_score)
    
        dunn_score = dunn(ModK)
        dunn_scores.append(dunn_score)





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    Fitting modified Kmeans with Raw data
    Running Kmeans for 4 clusters centers with 100 random initialisations.
      0%|                                                                                                                                                   |  : 0/100 [00:00<?,       ?it/s]      5%|#######1                                                                                                                                       |  : 5/100 [00:00<00:07,   11.88it/s]     10%|##############2                                                                                                                               |  : 10/100 [00:00<00:07,   11.75it/s]     15%|#####################3                                                                                                                        |  : 15/100 [00:01<00:07,   11.69it/s]     20%|############################4                                                                                                                 |  : 20/100 [00:01<00:06,   11.55it/s]     25%|###################################5                                                                                                          |  : 25/100 [00:02<00:06,   11.66it/s]     30%|##########################################6                                                                                                   |  : 30/100 [00:02<00:06,   11.50it/s]     35%|#################################################6                                                                                            |  : 35/100 [00:03<00:05,   11.50it/s]     40%|########################################################8                                                                                     |  : 40/100 [00:03<00:05,   11.39it/s]     45%|###############################################################9                                                                              |  : 45/100 [00:04<00:04,   11.30it/s]     50%|#######################################################################                                                                       |  : 50/100 [00:04<00:04,   11.09it/s]     55%|##############################################################################1                                                               |  : 55/100 [00:05<00:04,   10.95it/s]     60%|#####################################################################################2                                                        |  : 60/100 [00:05<00:03,   10.92it/s]     65%|############################################################################################3                                                 |  : 65/100 [00:06<00:03,   10.92it/s]     70%|###################################################################################################3                                          |  : 70/100 [00:07<00:02,   10.57it/s]     75%|##########################################################################################################5                                   |  : 75/100 [00:07<00:02,   10.73it/s]     80%|#################################################################################################################6                            |  : 80/100 [00:08<00:01,   10.62it/s]     85%|########################################################################################################################7                     |  : 85/100 [00:08<00:01,   10.77it/s]     90%|###############################################################################################################################8              |  : 90/100 [00:08<00:00,   10.76it/s]     95%|######################################################################################################################################9       |  : 95/100 [00:09<00:00,   10.70it/s]    100%|#############################################################################################################################################|  : 100/100 [00:09<00:00,   10.58it/s]    100%|#############################################################################################################################################|  : 100/100 [00:09<00:00,   10.03it/s]
    Selecting run with highest GEV = 0.6816047968052894%.
    Fitting modified Kmeans with Raw data
    Running Kmeans for 5 clusters centers with 100 random initialisations.
      0%|                                                                                                                                                   |  : 0/100 [00:00<?,       ?it/s]      5%|#######1                                                                                                                                       |  : 5/100 [00:00<00:07,   12.38it/s]     10%|##############2                                                                                                                               |  : 10/100 [00:00<00:07,   12.39it/s]     15%|#####################3                                                                                                                        |  : 15/100 [00:01<00:07,   12.03it/s]     20%|############################4                                                                                                                 |  : 20/100 [00:02<00:06,   11.82it/s]     25%|###################################5                                                                                                          |  : 25/100 [00:02<00:06,   11.58it/s]     30%|##########################################6                                                                                                   |  : 30/100 [00:02<00:05,   11.68it/s]     35%|#################################################6                                                                                            |  : 35/100 [00:03<00:05,   11.57it/s]     40%|########################################################8                                                                                     |  : 40/100 [00:04<00:05,   11.15it/s]     45%|###############################################################9                                                                              |  : 45/100 [00:04<00:04,   11.14it/s]     50%|#######################################################################                                                                       |  : 50/100 [00:05<00:04,   10.74it/s]     55%|##############################################################################1                                                               |  : 55/100 [00:06<00:04,   10.31it/s]     60%|#####################################################################################2                                                        |  : 60/100 [00:06<00:03,   10.23it/s]     65%|############################################################################################3                                                 |  : 65/100 [00:07<00:03,   10.16it/s]     70%|###################################################################################################3                                          |  : 70/100 [00:08<00:02,   10.08it/s]     75%|##########################################################################################################5                                   |  : 75/100 [00:08<00:02,    9.75it/s]     80%|#################################################################################################################6                            |  : 80/100 [00:09<00:02,    9.67it/s]     85%|########################################################################################################################7                     |  : 85/100 [00:09<00:01,    9.81it/s]     90%|###############################################################################################################################8              |  : 90/100 [00:10<00:01,    9.69it/s]     95%|######################################################################################################################################9       |  : 95/100 [00:11<00:00,    9.65it/s]    100%|#############################################################################################################################################|  : 100/100 [00:11<00:00,    9.65it/s]    100%|#############################################################################################################################################|  : 100/100 [00:11<00:00,    8.67it/s]
    Selecting run with highest GEV = 0.6953876070566268%.
    Fitting modified Kmeans with Raw data
    Running Kmeans for 6 clusters centers with 100 random initialisations.
      0%|                                                                                                                                                   |  : 0/100 [00:00<?,       ?it/s]      5%|#######1                                                                                                                                       |  : 5/100 [00:00<00:07,   12.75it/s]     10%|##############2                                                                                                                               |  : 10/100 [00:00<00:07,   12.67it/s]     15%|#####################3                                                                                                                        |  : 15/100 [00:01<00:06,   12.41it/s]     20%|############################4                                                                                                                 |  : 20/100 [00:02<00:06,   11.85it/s]     25%|###################################5                                                                                                          |  : 25/100 [00:02<00:06,   11.38it/s]     30%|##########################################6                                                                                                   |  : 30/100 [00:03<00:06,   11.15it/s]     35%|#################################################6                                                                                            |  : 35/100 [00:04<00:05,   11.09it/s]     40%|########################################################8                                                                                     |  : 40/100 [00:04<00:05,   10.66it/s]     45%|###############################################################9                                                                              |  : 45/100 [00:05<00:05,   10.49it/s]     50%|#######################################################################                                                                       |  : 50/100 [00:06<00:04,   10.26it/s]     55%|##############################################################################1                                                               |  : 55/100 [00:06<00:04,   10.15it/s]     60%|#####################################################################################2                                                        |  : 60/100 [00:07<00:04,    9.96it/s]     65%|############################################################################################3                                                 |  : 65/100 [00:08<00:03,    9.52it/s]     70%|###################################################################################################3                                          |  : 70/100 [00:08<00:03,    9.53it/s]     75%|##########################################################################################################5                                   |  : 75/100 [00:09<00:02,    9.52it/s]     80%|#################################################################################################################6                            |  : 80/100 [00:10<00:02,    9.30it/s]     85%|########################################################################################################################7                     |  : 85/100 [00:10<00:01,    9.17it/s]     90%|###############################################################################################################################8              |  : 90/100 [00:11<00:01,    9.09it/s]     95%|######################################################################################################################################9       |  : 95/100 [00:12<00:00,    8.81it/s]    100%|#############################################################################################################################################|  : 100/100 [00:13<00:00,    8.83it/s]    100%|#############################################################################################################################################|  : 100/100 [00:13<00:00,    7.67it/s]
    Selecting run with highest GEV = 0.7071110041189713%.
    Fitting modified Kmeans with Raw data
    Running Kmeans for 7 clusters centers with 100 random initialisations.
      0%|                                                                                                                                                   |  : 0/100 [00:00<?,       ?it/s]      5%|#######1                                                                                                                                       |  : 5/100 [00:00<00:14,    6.51it/s]     10%|##############2                                                                                                                               |  : 10/100 [00:01<00:13,    6.45it/s]     15%|#####################3                                                                                                                        |  : 15/100 [00:02<00:13,    6.43it/s]     20%|############################4                                                                                                                 |  : 20/100 [00:03<00:12,    6.41it/s]     25%|###################################5                                                                                                          |  : 25/100 [00:04<00:11,    6.35it/s]     30%|##########################################6                                                                                                   |  : 30/100 [00:04<00:10,    6.41it/s]     35%|#################################################6                                                                                            |  : 35/100 [00:05<00:10,    6.34it/s]     40%|########################################################8                                                                                     |  : 40/100 [00:06<00:09,    6.31it/s]     45%|###############################################################9                                                                              |  : 45/100 [00:07<00:08,    6.32it/s]     50%|#######################################################################                                                                       |  : 50/100 [00:08<00:07,    6.29it/s]     55%|##############################################################################1                                                               |  : 55/100 [00:08<00:07,    6.35it/s]     60%|#####################################################################################2                                                        |  : 60/100 [00:10<00:06,    6.25it/s]     65%|############################################################################################3                                                 |  : 65/100 [00:11<00:05,    6.17it/s]     70%|###################################################################################################3                                          |  : 70/100 [00:11<00:04,    6.25it/s]     75%|##########################################################################################################5                                   |  : 75/100 [00:12<00:04,    6.24it/s]     80%|#################################################################################################################6                            |  : 80/100 [00:13<00:03,    6.23it/s]     85%|########################################################################################################################7                     |  : 85/100 [00:14<00:02,    6.16it/s]     90%|###############################################################################################################################8              |  : 90/100 [00:15<00:01,    6.10it/s]     95%|######################################################################################################################################9       |  : 95/100 [00:15<00:00,    6.19it/s]    100%|#############################################################################################################################################|  : 100/100 [00:16<00:00,    6.12it/s]    100%|#############################################################################################################################################|  : 100/100 [00:16<00:00,    5.94it/s]
    Selecting run with highest GEV = 0.7177046233266179%.




.. GENERATED FROM PYTHON SOURCE LINES 70-71

We can compute this score for differents values of n_clusters.

.. GENERATED FROM PYTHON SOURCE LINES 71-86

.. code-block:: default

    import matplotlib.pyplot as plt

    fig, axs = plt.subplots(4,1)
    axs[0].plot(K,silhouette_scores)
    axs[0].set_title('Silhouette')
    axs[1].plot(K,davies_bouldin_scores)
    axs[1].set_title('davies-bouldin')
    axs[2].plot(K,calinski_harabasz_scores)
    axs[2].set_title('calinski-harabasz')
    axs[3].plot(K,dunn_scores)
    axs[3].set_title('Dunn')

    #sphinx_gallery_thumbnail_number = 2
    plt.tight_layout()
    plt.plot()



.. image:: /auto_tutorials/clustering/images/sphx_glr_plot_find_best_number_of_clusters_002.png
    :alt: Silhouette, davies-bouldin, calinski-harabasz, Dunn
    :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none


    []




.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 2 minutes  4.327 seconds)


.. _sphx_glr_download_auto_tutorials_clustering_plot_find_best_number_of_clusters.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: plot_find_best_number_of_clusters.py <plot_find_best_number_of_clusters.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: plot_find_best_number_of_clusters.ipynb <plot_find_best_number_of_clusters.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
