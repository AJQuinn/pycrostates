
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_tutorials\plot_Single_subject.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_auto_tutorials_plot_Single_subject.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_tutorials_plot_Single_subject.py:


Single Subject Segmentation
===========================

This example demonstrates how to segment a single subject recording into microstates sequence.

.. GENERATED FROM PYTHON SOURCE LINES 7-18

.. code-block:: default


    import os.path as op
    import mne
    from mne.io import concatenate_raws, read_raw_edf
    from mne.datasets import eegbci
    from mne.channels import make_standard_montage
    import pandas as pd

    import pycrostates
    from pycrostates.clustering import ModKMeans
    from pycrostates.metrics import compute_metrics




.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    c:\users\ferat\appdata\local\continuum\miniconda3\envs\sci37\lib\importlib\_bootstrap.py:219: RuntimeWarning: numpy.ufunc size changed, may indicate binary incompatibility. Expected 192 from C header, got 216 from PyObject
      return f(*args, **kwds)




.. GENERATED FROM PYTHON SOURCE LINES 19-23

This is the first section!
The `#%%` signifies to Sphinx-Gallery that this text should be rendered as
rST and if using one of the above IDE/plugin's, also signifies the start of a
'code block'.

.. GENERATED FROM PYTHON SOURCE LINES 23-38

.. code-block:: default


    subject = 1
    runs = [1,2,3]  # motor imagery: hands vs feet

    raw_fnames = eegbci.load_data(subject, runs, update_path=True)
    raw_files = [read_raw_edf(f, preload=True) for f in raw_fnames]
    raw = concatenate_raws(raw_files)
    eegbci.standardize(raw)  # set channel names

    raw.rename_channels(lambda x: x.strip('.'))
    montage = make_standard_montage('standard_1005')
    raw.set_montage(montage)

    raw.pick('eeg')
    raw.set_eeg_reference('average')




.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    Extracting EDF parameters from C:\Users\ferat\mne_data\MNE-eegbci-data\files\eegmmidb\1.0.0\S001\S001R01.edf...
    EDF file detected
    Setting channel info structure...
    Creating raw.info structure...
    Reading 0 ... 9759  =      0.000 ...    60.994 secs...
    Extracting EDF parameters from C:\Users\ferat\mne_data\MNE-eegbci-data\files\eegmmidb\1.0.0\S001\S001R02.edf...
    EDF file detected
    Setting channel info structure...
    Creating raw.info structure...
    Reading 0 ... 9759  =      0.000 ...    60.994 secs...
    Extracting EDF parameters from C:\Users\ferat\mne_data\MNE-eegbci-data\files\eegmmidb\1.0.0\S001\S001R03.edf...
    EDF file detected
    Setting channel info structure...
    Creating raw.info structure...
    Reading 0 ... 19999  =      0.000 ...   124.994 secs...
    EEG channel type selected for re-referencing
    Applying average reference.
    Applying a custom EEG reference.

    <RawEDF | S001R01.edf, 64 x 39520 (247.0 s), ~19.4 MB, data loaded>



.. GENERATED FROM PYTHON SOURCE LINES 39-41

Fit the modified Kmeans algorithm with the raw data. Here we use ``gfp=True`` to extract gfp peaks on fly.
Note that, depending on your setup, you can change ``n_jobs=1`` in order to use parallel processing and speed up the process.

.. GENERATED FROM PYTHON SOURCE LINES 41-46

.. code-block:: default


    n_clusters = 4
    ModK = ModKMeans(n_clusters=n_clusters)
    ModK.fit(raw, gfp=True, n_jobs=5)





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

      0%|                                                                                                                                                                                    |  : 0/100 [00:00<?,       ?it/s]      5%|########8                                                                                                                                                                       |  : 5/100 [00:03<01:06,    1.44it/s]     10%|#################5                                                                                                                                                             |  : 10/100 [00:04<00:59,    1.50it/s]     15%|##########################2                                                                                                                                                    |  : 15/100 [00:04<00:54,    1.56it/s]     20%|###################################                                                                                                                                            |  : 20/100 [00:05<00:49,    1.62it/s]     25%|###########################################7                                                                                                                                   |  : 25/100 [00:06<00:44,    1.69it/s]     30%|####################################################5                                                                                                                          |  : 30/100 [00:07<00:40,    1.75it/s]     35%|#############################################################2                                                                                                                 |  : 35/100 [00:08<00:35,    1.81it/s]     40%|######################################################################                                                                                                         |  : 40/100 [00:09<00:32,    1.86it/s]     45%|##############################################################################7                                                                                                |  : 45/100 [00:10<00:28,    1.93it/s]     50%|#######################################################################################5                                                                                       |  : 50/100 [00:11<00:25,    1.99it/s]     55%|################################################################################################2                                                                              |  : 55/100 [00:11<00:21,    2.07it/s]     60%|#########################################################################################################                                                                      |  : 60/100 [00:12<00:18,    2.14it/s]     65%|#################################################################################################################7                                                             |  : 65/100 [00:13<00:15,    2.19it/s]     70%|##########################################################################################################################4                                                    |  : 70/100 [00:14<00:13,    2.28it/s]     75%|###################################################################################################################################2                                           |  : 75/100 [00:14<00:10,    2.36it/s]     80%|############################################################################################################################################                                   |  : 80/100 [00:15<00:08,    2.43it/s]     85%|####################################################################################################################################################7                          |  : 85/100 [00:16<00:05,    2.52it/s]     90%|#############################################################################################################################################################5                 |  : 90/100 [00:17<00:03,    2.60it/s]     95%|######################################################################################################################################################################2        |  : 95/100 [00:17<00:01,    2.69it/s]    100%|##############################################################################################################################################################################|  : 100/100 [00:18<00:00,    2.77it/s]    100%|##############################################################################################################################################################################|  : 100/100 [00:18<00:00,    5.35it/s]

    ()



.. GENERATED FROM PYTHON SOURCE LINES 47-50

Now that our algorithm is fitted, we can visualise the cluster centers, also called Microstate maps or Microstate topographies
using :meth:`ModK.plot_cluster_centers`. Note than this method uses the :class:`~mne.Info` object of the fitted instance to display
the topographies.

.. GENERATED FROM PYTHON SOURCE LINES 50-52

.. code-block:: default

    ModK.plot_cluster_centers()




.. image:: /auto_tutorials/images/sphx_glr_plot_Single_subject_001.png
    :alt: plot Single subject
    :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none


    (<Figure size 640x480 with 4 Axes>, array([<matplotlib.axes._subplots.AxesSubplot object at 0x0000028CD60623C8>,
           <matplotlib.axes._subplots.AxesSubplot object at 0x0000028CD60A4988>,
           <matplotlib.axes._subplots.AxesSubplot object at 0x0000028CD60DD5C8>,
           <matplotlib.axes._subplots.AxesSubplot object at 0x0000028CD6117248>],
          dtype=object))



.. GENERATED FROM PYTHON SOURCE LINES 53-54

Predict.

.. GENERATED FROM PYTHON SOURCE LINES 54-57

.. code-block:: default

    segmentation = ModK.predict(raw, half_window_size=5, factor=10)
    pycrostates.viz.plot_segmentation(segmentation, raw)




.. image:: /auto_tutorials/images/sphx_glr_plot_Single_subject_002.png
    :alt: Segmentation
    :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none


    (<Figure size 1000x400 with 2 Axes>, [<matplotlib.lines.Line2D object at 0x0000028CD63D3A08>])



.. GENERATED FROM PYTHON SOURCE LINES 58-59

Compute microstate parameters and convert results into a :class:`~pandas.DataFrame`.

.. GENERATED FROM PYTHON SOURCE LINES 59-61

.. code-block:: default

    metrics = compute_metrics(segmentation, ModK.cluster_centers, raw, norm_gfp=True)
    df = pd.DataFrame([metrics])
    df




.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div>
    <style scoped>
        .dataframe tbody tr th:only-of-type {
            vertical-align: middle;
        }

        .dataframe tbody tr th {
            vertical-align: top;
        }

        .dataframe thead th {
            text-align: right;
        }
    </style>
    <table border="1" class="dataframe">
      <thead>
        <tr style="text-align: right;">
          <th></th>
          <th>state_1_dist_corr</th>
          <th>state_1_mean_corr</th>
          <th>state_1_dist_gev</th>
          <th>state_1_gev</th>
          <th>state_1_timecov</th>
          <th>state_1_dist_durs</th>
          <th>state_1_meandurs</th>
          <th>state_1_occurences</th>
          <th>state_2_dist_corr</th>
          <th>state_2_mean_corr</th>
          <th>state_2_dist_gev</th>
          <th>state_2_gev</th>
          <th>state_2_timecov</th>
          <th>state_2_dist_durs</th>
          <th>state_2_meandurs</th>
          <th>state_2_occurences</th>
          <th>state_3_dist_corr</th>
          <th>state_3_mean_corr</th>
          <th>state_3_dist_gev</th>
          <th>state_3_gev</th>
          <th>state_3_timecov</th>
          <th>state_3_dist_durs</th>
          <th>state_3_meandurs</th>
          <th>state_3_occurences</th>
          <th>state_4_dist_corr</th>
          <th>state_4_mean_corr</th>
          <th>state_4_dist_gev</th>
          <th>state_4_gev</th>
          <th>state_4_timecov</th>
          <th>state_4_dist_durs</th>
          <th>state_4_meandurs</th>
          <th>state_4_occurences</th>
          <th>unlabeled_timecov</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th>0</th>
          <td>[-0.1590050036066257, -0.1309424457445233, -0....</td>
          <td>0.574879</td>
          <td>[2.0590772687252248e-07, 1.5873207133906916e-0...</td>
          <td>0.109196</td>
          <td>0.280873</td>
          <td>[0.0875, 0.24375, 0.09375, 0.08125, 0.13125, 0...</td>
          <td>0.119699</td>
          <td>0.293846</td>
          <td>[-0.5040041762983047, -0.47448534292690014, -0...</td>
          <td>0.761762</td>
          <td>[1.369268482410974e-06, 7.571930789232302e-07,...</td>
          <td>0.22594</td>
          <td>0.144429</td>
          <td>[0.06875, 0.08125, 0.2125, 0.18125, 0.625, 0.3...</td>
          <td>0.125512</td>
          <td>0.144103</td>
          <td>[-0.3157715734740371, -0.2177844450573803, -0....</td>
          <td>0.55667</td>
          <td>[8.392337227630888e-07, 3.5628321957488003e-07...</td>
          <td>0.16672</td>
          <td>0.34898</td>
          <td>[0.3, 0.04375, 0.10625, 0.1125, 0.06875, 0.15,...</td>
          <td>0.135699</td>
          <td>0.322051</td>
          <td>[-0.6890936173718516, -0.6976906187641585, -0....</td>
          <td>0.609712</td>
          <td>[6.713845316805786e-06, 4.647946495632368e-06,...</td>
          <td>0.103278</td>
          <td>0.225717</td>
          <td>[0.075, 0.0375, 0.0625, 0.05625, 0.08125, 0.04...</td>
          <td>0.117775</td>
          <td>0.24</td>
          <td>0.011492</td>
        </tr>
      </tbody>
    </table>
    </div>
    </div>
    <br />
    <br />


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  21.309 seconds)


.. _sphx_glr_download_auto_tutorials_plot_Single_subject.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: plot_Single_subject.py <plot_Single_subject.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: plot_Single_subject.ipynb <plot_Single_subject.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
